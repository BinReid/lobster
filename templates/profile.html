{% extends 'base.html' %}

{% block content %}
    <div class="profile-container">
        <h1>Профиль</h1>
        
        <div class="avatar">
            <img src="{{ url_for('static', filename='images/avatar.png') }}" />
        </div>
        
        <div class="profile-info">
            <h2 class="full-name">{{ username }}</h2>
            <p class="role"><strong>Роль:</strong> {{ role }}</p>
            <p class="region"><strong>Регион:</strong> {{ region }}</p>
        </div>
        
        <div class="protocols">
            <h3>Итоговые протоколы</h3>
            <button type="button" class="btn-search" onclick="selectAllProtocols()">Выделить все</button>
            <ul>
                {% for protocol in protocols %}
                    <li>
                        <input type="checkbox" class="protocol-checkbox" id="{{ protocol }}" value="{{ protocol }}">
                        <label for="{{ protocol }}">{{ protocol }}</label>
                    </li>
                {% endfor %}
            </ul>
            <button type="button" class="btn-search" onclick="downloadSelectedProtocols()">Скачать выбранные</button>
        </div>
        
        <div class="statistics">
            <h3>Статистика региона</h3>
            <p><strong>Количество участников:</strong> {{ participant_count }}</p>
            <p><strong>Средний балл:</strong> {{ average_score }}</p>
        </div>
        
        <div class="profile-actions">
            <a href="#" class="btn-search" onclick="showUnavailableMessage(event)">Редактировать профиль</a>
            <a href="{{ url_for('logout') }}" class="btn-search">Выйти</a>
        </div>

        <div id="message" style="display: none; color: red; margin-top: 20px;">
            Данная функция пока не доступна
        </div>
    </div>

    <script>
        function selectAllProtocols() {
            const checkboxes = document.querySelectorAll('.protocol-checkbox');
            const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
            checkboxes.forEach(checkbox => {
                checkbox.checked = !allChecked; // Если все выбраны, снимаем выбор, иначе выбираем все
            });
        }

        function downloadSelectedProtocols() {
            const selectedProtocols = Array.from(document.querySelectorAll('.protocol-checkbox:checked'))
                .map(checkbox => checkbox.value);
            
            if (selectedProtocols.length === 0) {
                alert('Пожалуйста, выберите хотя бы один протокол для скачивания.');
                return;
            }

            // Здесь вы можете добавить логику для скачивания выбранных протоколов
            console.log('Скачивание следующих протоколов:', selectedProtocols);
            // Например, отправка на сервер или создание ссылки для скачивания
        }

        function showUnavailableMessage(event) {
            event.preventDefault(); // Отменяем переход по ссылке
            document.getElementById('message').style.display = 'block'; // Показываем сообщение
        }
    </script>
{% endblock %}